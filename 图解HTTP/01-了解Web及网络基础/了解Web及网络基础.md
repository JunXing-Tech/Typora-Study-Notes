## 第一章	了解Web及网络基础

[toc]

> 本章概述了 Web 是建立在何种技术之上，以及 HTTP 协议是如何诞 生并发展的。我们从其背景着手，来深入了解这部分内容。

#### 1.1 使用 HTTP 协议访问 Web

**提问**：你知道当我们在网页浏览器（Web browser）的地址栏中输入 URL 时，Web 页面是如何呈现的吗？

**回答**：根据 Web 浏览器地址栏中指定的 URL，Web 浏览器从 Web 服务器端获取文件资源（resource）等信息，从而显示出 Web 页面。

> 像这种通过**发送请求获取服务器资源**的 Web 浏览器等，都可称为客户端（client）。

**如图**：<img src="D:\TyporaImageHost\image-20230607144834593.png" alt="image-20230607144834593" style="zoom: 80%;" />

图中的客户端在与服务器”互动“时，Web 使用一种名为 **HTTP（HyperText Transfer Protocol，超文本传输协议）**的协议作为规范，完成从客户端到服务器端等一系列运作流 程。而协议是指规则的约定。可以说，Web 是建立在 HTTP 协议上通信的。

#### 1.2 HTTP 的诞生

> 在深入学习 HTTP 之前，我们先来介绍一下 HTTP 诞生的背景。了解背景的同时也能了解当初制定 HTTP 的初衷，这样有助于我们更好地理解。

##### 1.2.1 为知识共享而规划 Web

1989 年 3 月，在CERN（欧洲核子研究组织）的蒂姆 • 伯纳斯 - 李（Tim BernersLee）博士提出了一种能让远隔两地的研究者们共享知识的设想。该设想的最初的基本理念是，**借助多文档之间相互关联形成的超文本（HyperText），连成可相互参阅的 WWW（World Wide Web，万维网）**。

##### 1.2.2 Web 成长时代

1. Web 1.0时代：Web 1.0时代是指从Web诞生到1999年左右的阶段。这个时代的Web主要是静态的，网站内容以文本和图片为主，用户只能被动地接收信息
2. Web 2.0时代：Web 2.0时代是指从2000年左右开始的阶段。这个时代的Web更加互动、社交和个性化，用户可以通过社交媒体、博客、在线论坛等方式来分享信息和交流。
3. 移动Web时代：移动Web时代是指从2007年iPhone发布以来的阶段。这个时代的Web主要是以移动设备为主，用户可以通过智能手机和平板电脑来访问网站和应用程序。
4. Web 3.0时代：Web 3.0时代是指从2010年左右开始的阶段。这个时代的Web主要是以人工智能和语义Web为核心，可以更好地理解和处理数据，提供更智能的服务和应用程序

##### 1.2.3 驻足不前的 HTTP

《图解HTTP》一书因出版时间为2014年，所以书中部分信息落后，故做补充。

* HTTP/0.9
  * HTTP 于 1990 年问世。那时的 HTTP 并没有作为正式的标准被建立。 现在的 HTTP 其实含有 HTTP1.0 之前版本的意思，因此被称为 HTTP/0.9。

* HTTP/1.0
  * HTTP 正式作为标准被公布是在 1996 年的 5 月，版本被命名为 HTTP/1.0，并记载于 RFC1945。

* HTTP/1.1
  * HTTP/1.1（Hypertext Transfer Protocol 1.1）是HTTP协议的第一个正式版本，于1999年发布。它是Web应用程序的基础，用于在Web浏览器和Web服务器之间传输数据。
* HTTP/2.0
  * 2015年，HTTP/2 发布。HTTP/2是现行HTTP协议（HTTP/1.x）的替代，但它不是重写，HTTP方法/状态码/语义都与HTTP/1.x一样。
* HTTP/3.0
  * 2022年6月6日HTTP/3(RFC9114)正式发布，HTTP3 本质不是对 HTTP 协议本身的改进，它主要是集中在如何提高传输效率。

#### 1.3 网络基础 TCP/IP

> 通常使用的网络（包括互联网）是在 TCP/IP 协议族的基础上运作的。而 HTTP 属于它内部的一个子集。

##### 1.3.1 TCP/IP 协议族

**协议的概念**：计算机与网络设备要相互通信，双方就必须基于相同的方法。不同的硬件、操作系统之 间的通信，所有的这一切都需要一种规则。而我们就把这种规则称为**协议（protocol)**。

**TCP/IP是什么？**

TCP/IP 是互联网相关的各类协议族的总称。

**如图**：<img src="D:\TyporaImageHost\image-20230607152435502.png" alt="image-20230607152435502" style="zoom: 50%;" />

##### 1.3.2 TCP/IP 的分层管理

TCP/IP 协议族里重要的一点就是**分层**。TCP/IP 协议族按层次分别分为以下 4 层：<u>**应用层、传输层、网络层和数据链路层**</u>。

**为什么分层？**

TCP/IP 层次化有两个好处。**一是**：分层设计可以使互联网更加灵活，因为如果只有一个协议，需要替换整个系统。而分层设计只需要替换变动的层，各层之间的接口已经规划好，内部设计可以自由改动。**二是**：分层设计使得设计变得简单。应用层只需要考虑自己的任务，而不需要关心对方的位置、传输路线或者传输是否可靠。

**TCP/IP 协议族各层有何作用？**

1. 应用层

应用层决定了向用户提供应用服务时通信的活动。 TCP/IP 协议族内预存了各类通用的应用服务。比如，FTP（File Transfer Protocol，文件传输协议）和 DNS（Domain Name System，域名系统）服务就是其中两类。 HTTP 协议也处于该层。

2. 传输层

传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。 在传输层有两个性质不同的协议：TCP（Transmission Control Protocol，传输控制协议）和 UDP（User Data Protocol，用户数据报 协议）。

3. 网络层

网络层用来处理在网络上流动的数据包。数据包是网络传输的最小数据单位。该层规定了通过怎样的路径（所谓的传输路线）到达对方计算机，并把数据包传送给对方。 与对方计算机之间通过多台计算机或网络设备进行传输时，网络层所起的作用就是在众多的选项内选择一条传输路线。

4. 链路层

用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱动、NIC（Network Interface Card，网络适配器，即网卡），及光纤等物理可见部分（还包括连接器等一切传输媒介）。硬件上的范畴均在链路层的作用范围之内。

##### 1.3.3 TCP/IP 通信传输流

> 利用 TCP/IP 协议族进行网络通信时，会通过分层顺序与对方进行通信。**发送端**从应用层往下走，**接收端**则往应用层往上走。

**如图**

<img src="D:\TyporaImageHost\image-20230608112556049.png" alt="image-20230608112556049" style="zoom: 45%;" />

可以分为四步（用 HTTP 举例来说明）：

1. 首先作为发送端的**客户端**在**应用层 （HTTP 协议）发出**一个想看某个 Web 页面的 **HTTP 请求**。
2. 接着，为了传输方便，在**传输层（TCP 协议）把从应用层处收到的数据（HTTP 请求报文）进行分割，并在各个报文上打上标记序号及端口号后转发给网络层**。
3. 在**网络层（IP 协议），增加作为通信目的地的 MAC 地址后转发给链路层**。这样一来，发往网络的通信请求就准备齐全了。
4. **接收端的服务器在链路层接收到数据，按序往上层发送，一直到应用层**。当传输到应用层，才能算真正接收到由客户端发送过来的 HTTP 请求。

在上面的四步中，我们可以发现在传输层和网络层都有对数据进行处理，那么为什么要处理以及处理的细节是什么？

**如图**

<img src="D:\TyporaImageHost\image-20230608113455193.png" alt="image-20230608113455193" style="zoom:45%;" />

可知，发送端在层与层之间传输数据时，每经过一层时必定会被**打上**一个该层所属的首部信息。反之，接收端在层与层传输数据时，每经过一层时会把对应的首部**消去**。

这种把数据信息包装起来的做法称为**封装（encapsulate）**。

#### 1.4 与 HTTP 关系密切的协议 : IP、TCP 和 DNS

> 下面我们分别针对在 TCP/IP 协议族中与 HTTP 密不可分的 3 个协议 （IP、TCP 和 DNS）进行说明。

##### 1.4.1 负责传输的 IP 协议

**IP协议的层次及重用性**

按层次分，IP（Internet Protocol）网际协议位于网络层。所有使用网络的系统都会用到 IP 协议。TCP/IP 协议族中的 IP 指的就是网际协议，协议名称中占据了一半位置，其重要性可见一斑。

**IP协议的作用**

IP 协议的作用是**把各种数据包传送给对方**。而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要的条件是 **IP 地址和 MAC 地址（Media Access Control Address）**。 

IP 地址指明了**节点被分配到的地址**，MAC 地址是指**网卡所属的固定地址**。IP 地址可以和 MAC 地址进行配对。IP 地址可变换，但 MAC 地址基本上不会更改。

**使用 ARP 协议凭借 MAC 地址进行通信**

**IP 间的通信依赖 MAC 地址**。在网络上，通信的双方在同一局域网 （LAN）内的情况是很少的，通常是经过**多台计算机和网络设备中转**才能连接到对方。**而在进行中转时，会利用下一站中转设备的 MAC 地址来搜索下一个中转目标**。这时，会采用 **ARP 协议（Address Resolution Protocol）**。

**什么是ARP协议？**

ARP 是一种用以解析地址的协议，**根据通信方的IP 地址就可以反查出对应的 MAC 地址**。当一个主机需要与另一个主机通信时，它需要知道目标主机的MAC地址，而ARP协议就是用于查询目标主机的MAC地址的。ARP协议是在**网络层和数据链路层之间的协议**，它的作用是**在这两个层之间建立映射关系**。

**互联网中的传输状况**

没有人能够全面掌握互联网中的传输状况，在到达通信目标前的中转过程中，那些计算机和路由器等网络设备只 能获悉很粗略的传输路线。

> 这种机制称为**路由选择（routing）**，有点像快递公司的送货过程。想要寄快递的人，只要将自己的货物送到集散中心，就可以知道快递公司是否肯收件发货，该快递公司的集散中心检查货物的送达地址，明 确下站该送往哪个区域的集散中心。接着，那个区域的集散中心自会 判断是否能送到对方的家中。

综上所述，我们能大致IP协议的传输方式，**如下图**

<img src="D:\TyporaImageHost\image-20230608142319437.png" alt="image-20230608142319437" style="zoom:50%;" />

##### 1.4.2 确保可靠性的 TCP 协议

> 按层次分，TCP 位于传输层，提供可靠的**字节流服务**。

**什么是字节流服务？**

所谓的字节流服务（Byte Stream Service）是指，**为了方便传输，将大块数据分割成以报文段（segment）为单位的数据包进行管理**。而可靠的传输服务是指，**能够把数据准确可靠地传给对方**。一言以蔽之， TCP 协议为了更容易传送大数据才把数据分割，而且 TCP 协议能够确认数据最终是否送达到对方。

**确保数据能到达目标**

为了准确无误地将数据送达目标处，TCP 协议采用了**三次握手 （three-way handshaking）策略**。用 TCP 协议把数据包送出去后，TCP 不会对传送后的情况置之不理，它一定会向对方确认是否成功送达。

握手过程中使用了 TCP 的标志（flag） —— **SYN（synchronize） **和 **ACK（acknowledgement）**。

1. 发送端首先发送一个带 SYN 标志的数据包给对方，表示要建立连接。
2. 接收端收到后， 回传一个带有 SYN/ACK 标志的数据包以示传达确认信息，并提出自己的连接请求。
3. 最后，发送端再回传一个带 ACK 标志的数据包，代表“握手”结束。

这个过程也被称为三次握手过程，其中 **SYN 标志用于同步序列号**，**ACK 标志用于确认收到的数据包**。通过这个过程，客户端和服务器可以建立可靠的连接，开始数据的传输。

若在握手过程中某个阶段莫名中断，TCP 协议会再次以相同的顺序发 送相同的数据包。

**如图所示**

<img src="D:\TyporaImageHost\image-20230608144459927.png" alt="image-20230608144459927" style="zoom: 50%;" />

除了上述三次握手，TCP 协议还有其他各种手段来保证通信的可靠性。比如：1.序列号和确认应答、2.序列号和确认应答、3.滑动窗口、4.拥塞控制、5.接收方窗口控制。

#### 1.5 负责域名解析的 DNS 服务

> DNS（Domain Name System）服务是和 HTTP 协议一样位于应用层的协议。它**提供域名到 IP 地址之间的解析服务**。

**DNS服务是“服务”什么的？**

我们知道，计算机既可以被赋予 IP 地址，也可以被赋予主机名和域名。在用户方面，用户通常使用主机名或域名来访问对方的计算机，而不是直接通过 IP 地址访问。因为与 IP 地址的一组纯数字相比，用字母配合数字的表 示形式来指定计算机名更符合人类的记忆习惯。但是在计算机方面，为计算机更擅 长处理一长串数字。

为了解决上述的问题，DNS 服务应运而生。**DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务**。

**如图**

<img src="D:\TyporaImageHost\image-20230608145037289.png" alt="image-20230608145037289" style="zoom: 50%;" />

#### 1.6 各种协议与 HTTP 协议的关系

> 学习了和 HTTP 协议密不可分的 TCP/IP 协议族中的各种协议后，我 们再通过这张图来了解下 IP 协议、TCP 协议和 DNS 服务在使用 HTTP 协议的通信过程中各自发挥了哪些作用。

**如图**

<img src="D:\TyporaImageHost\image-20230608145252003.png" alt="image-20230608145252003" style="zoom:50%;" />

#### 1.7 URI 和 URL

> URI（Uniform Resource Identifier）是标识某一资源的字符串， URL（Uniform Resource Locator）是包含了该资源位置信息的 URI。

##### 1.7.1 统一资源标识符

URI 是 Uniform Resource Identifier 的缩写。RFC2396 分别对这 3 个单 词进行了如下定义。

* **Uniform**

规定统一的格式可方便处理多种不同类型的资源，而不用根据上下文环境来识别资源指定的访问方式。

* **Resource**

资源的定义是“可标识的任何东西”。除了文档文件、图像或服务（例 如当天的天气预报）等能够区别于其他类型的，全都可作为资源。另外，资源不仅可以是单一的，也可以是多数的集合体。

* **Identifier**

表示可标识的对象。也称为标识符。 

综上所述，URI 就是由某个协议方案表示的资源的定位标识符。协议方案是指访问资源所使用的协议类型名称。 采用 HTTP 协议时，协议方案就是 http。除此之外，还有 ftp、 25 mailto、telnet、file 等。

**URI与URL的异同**

**URI 用字符串标识某一互联网资源，而 URL表示资源的地点（互联网上所处的位置）。可见 URL是 URI 的子集**。

##### 1.7.2 URI 格式

表示指定的 URI，要使用涵盖全部必要信息的绝对 URI、绝对 URL以及相对 URL。相对 URL，是指从浏览器中基本 URI 处指定的 URL， 形如 /image/logo.gif。

**绝对URI的格式**

![image-20230608150337303](D:\TyporaImageHost\image-20230608150337303.png)

```markdown
http://user:pass@www.example.jp:80/dir/index.htm?uid=1#ch1
```

**那么，绝对URI格式的各部分又有什么作用和含义呢？**

* **协议方案名**

使用 http: 或 https: 等协议方案名获取访问资源时要指定协议类型。不区分字母大小写，最后附一个冒号（:）。也可使用 data: 或 javascript: 这类指定数据或脚本程序的方案名。

* **登录信息（认证）**

指定用户名和密码作为从服务器端获取资源时必要的登录信息（身份认证）。此项是可选项。

* **服务器地址**

使用绝对 URI 必须指定待访问的服务器地址。地址可以是类似 hackr.jp 这种 DNS 可解析的名称，或是 192.168.1.1 这类 IPv4 地址 名，还可以是 [0:0:0:0:0:0:0:1] 这样用方括号括起来的 IPv6 地址名。

* **服务器端口号**

指定服务器连接的网络端口号。此项也是可选项，若用户省略则自动 使用默认端口号。

* **带层次的文件路径**

指定服务器上的文件路径来定位特指的资源。这与 UNIX 系统的文件 目录结构相似。

* **查询字符串**

针对已指定的文件路径内的资源，可以使用查询字符串传入任意参 数。此项可选。

* **片段标识符**

使用片段标识符通常可标记出已获取资源中的子资源（文档内的某个 位置）。但在 RFC 中并没有明确规定其使用方法。该项也为可选项。

#### 1.8 总结

```mermaid
graph LR
A[了解Web及网络基础] --> B[1.1 使用HTTP协议访问Web] --> HTTP与web的交互方式
A --> C[1.2 HTTP的诞生]
C --> D[1.2.1 为知识共享而规划Web]
C --> c1[1.2.2 Web成长时代]
C --> c2[1.2.3 驻足不前的HTTP]
A --> E[1.3 网络基础TCP/IP]
E --> F[1.3.1 TCP/IP协议族]
F --> 什么是TCP/IP协议族
E --> G[1.3.2 TCP/IP的分层管理]
G --> 应用层&nbsp传输层&nbsp网络层&nbsp数据链路层
E --> H[1.3.3 TCP/IP通信传输流]
A --> J[1.4 与HTTP关系密切的协议IP TCP和DNS]
J --> K[1.4.1 负责传输的IP协议]
K --> IP地址&nbspMAC地址&nbspARP协议
J --> L[1.4.2 确保可靠性的TCP协议]
L --> 字节流服务&nbspSYN和ACK
A --> N[1.5 负责域名解析的DNS服务]
N --> O[讲述了何为DNS服务]
A --> P[1.6 各种协议和HTTP协议的关系]
P --> Q[文章中的图很好的说明了这一点]
A --> R[1.7 URI和URL]
R --> S[1.7.1 统一资源标识符]
R --> T[1.7.2 URI格式]
S --> U[URI和URL的关系及URI的组成]
```



